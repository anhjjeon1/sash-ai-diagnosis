<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì²­ê°œêµ¬ë¦¬ í•˜ìì§„ë‹¨ AIë¶„ì„ì•±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://developers.kakao.com/sdk/js/kakao.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');
        body { font-family: 'Noto Sans KR', sans-serif; }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div id="capture-area" class="max-w-md mx-auto bg-white min-h-screen shadow-xl overflow-hidden relative">
        
        <header class="bg-blue-600 p-4 text-white text-center relative">
            <h1 class="text-xl font-bold">ì²­ê°œêµ¬ë¦¬ í•˜ìì§„ë‹¨ AIë¶„ì„ì•±</h1>
            <p class="text-xs mt-1 opacity-80">Ver 10.9 (ìµœì¢…ì™„ì„±)</p>
        </header>

        <main class="p-5 pb-20">
            
            <div class="bg-yellow-50 p-4 mb-6 rounded-lg border border-yellow-200" id="apiKeySection">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-xs font-bold text-yellow-800">ğŸ”‘ API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ìµœì´ˆ 1íšŒ)</span>
                </div>
                <div class="flex gap-2">
                    <input type="password" id="apiKey" class="flex-1 p-2 border rounded text-xs">
                    <button onclick="saveApiKey()" class="bg-yellow-500 text-white px-3 py-1 rounded text-xs font-bold">ì €ì¥</button>
                </div>
            </div>

            <div class="space-y-4 mb-6">
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-1">ğŸ  ì¥ì†Œì…ë ¥</label>
                    <input type="text" id="location" class="w-full p-2 border rounded-lg" placeholder="ì˜ˆ: ê±°ì‹¤ ì°½í˜¸">
                </div>
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-1">ğŸ“… ì§„ë‹¨ì¼ì</label>
                    <input type="date" id="date" class="w-full p-2 border rounded-lg">
                </div>
                
                <div class="grid grid-cols-3 gap-2">
                    <button onclick="selectType(this, 'ê±´ì¶•')" class="type-btn p-2 border rounded text-xs font-bold hover:bg-gray-100">ê±´ì¶•í•˜ì</button>
                    <button onclick="selectType(this, 'ì°½í˜¸')" class="type-btn p-2 border rounded text-xs font-bold hover:bg-gray-100">ì°½í˜¸í•˜ì</button>
                    <button onclick="selectType(this, 'ê²°ë¡œ')" class="type-btn p-2 border rounded text-xs font-bold hover:bg-gray-100">ê²°ë¡œí•˜ì</button>
                    <button onclick="selectType(this, 'ëˆ„ìˆ˜')" class="type-btn p-2 border rounded text-xs font-bold hover:bg-gray-100">ëˆ„ìˆ˜í•˜ì</button>
                    <button onclick="selectType(this, 'ì†ŒìŒ')" class="type-btn p-2 border rounded text-xs font-bold hover:bg-gray-100">ì†ŒìŒí•˜ì</button>
                    <button onclick="selectType(this, 'ê¸°íƒ€')" class="type-btn p-2 border rounded text-xs font-bold hover:bg-gray-100">ê¸°íƒ€</button>
                </div>
                <input type="hidden" id="defectType">

                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-1">ğŸ“ í•˜ìì„¤ëª…</label>
                    <textarea id="description" rows="3" class="w-full p-2 border rounded-lg" placeholder="ìƒí™©ì„ ì„¤ëª…í•´ì£¼ì„¸ìš”"></textarea>
                </div>
            </div>

            <div class="space-y-6 mb-6">
                <div class="border rounded-lg p-4 bg-gray-50">
                    <h3 class="font-bold mb-2 text-sm">ğŸ“¸ 1. í˜„ì¥ ì‚¬ì§„(í•„ìˆ˜)</h3>
                    <img id="preview1" src="" class="w-full h-48 object-cover rounded mb-2 bg-gray-200" onclick="triggerUpload(1)">
                    <input type="file" id="fileInput1" accept="image/*" class="hidden" onchange="previewImage(event, 1)">
                    <button onclick="triggerUpload(1)" class="w-full bg-blue-100 text-blue-700 py-2 rounded font-bold text-sm">
                        ì‚¬ì§„ì…ë ¥
                    </button>
                    <p class="text-xs text-center text-gray-500 mt-1">ì‚¬ì§„ì…ë ¥ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì‚¬ì§„ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”!</p>
                </div>

                <div class="border rounded-lg p-4 bg-gray-50">
                    <h3 class="font-bold mb-2 text-sm">ğŸ“¸ 2. ìƒì„¸/ê¸°íƒ€ ì‚¬ì§„(ì„ íƒ)</h3>
                    <img id="preview2" src="" class="w-full h-48 object-cover rounded mb-2 bg-gray-200" onclick="triggerUpload(2)">
                    <input type="file" id="fileInput2" accept="image/*" class="hidden" onchange="previewImage(event, 2)">
                    <button onclick="triggerUpload(2)" class="w-full bg-blue-100 text-blue-700 py-2 rounded font-bold text-sm">
                        ì‚¬ì§„ì…ë ¥
                    </button>
                    <p class="text-xs text-center text-gray-500 mt-1">ì‚¬ì§„ì…ë ¥ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì‚¬ì§„ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”!</p>
                </div>

                <div class="border rounded-lg p-4 bg-gray-50">
                    <h3 class="font-bold mb-2 text-sm">ğŸ“¸ 3. ì—´í™”ìƒ/ê¸°íƒ€ ì‚¬ì§„(ì„ íƒ)</h3>
                    <img id="preview3" src="" class="w-full h-48 object-cover rounded mb-2 bg-gray-200" onclick="triggerUpload(3)">
                    <input type="file" id="fileInput3" accept="image/*" class="hidden" onchange="previewImage(event, 3)">
                    <button onclick="triggerUpload(3)" class="w-full bg-blue-100 text-blue-700 py-2 rounded font-bold text-sm">
                        ì‚¬ì§„ì…ë ¥
                    </button>
                    <p class="text-xs text-center text-gray-500 mt-1">ì‚¬ì§„ì…ë ¥ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì‚¬ì§„ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”!</p>
                </div>
            </div>

            <button onclick="analyzeImages()" id="analyzeBtn" class="w-full bg-blue-600 text-white py-3 rounded-lg font-bold shadow-lg hover:bg-blue-700 transition mb-6">
                ğŸš€ AI ì •ë°€ ì§„ë‹¨ ì‹œì‘
            </button>

            <div id="loading" class="hidden flex-col items-center justify-center py-4">
                <div class="loader mb-2"></div>
                <p class="text-sm text-gray-600">â³ AI ì „ë¬¸ê°€ê°€ ì •ë°€ ì§„ë‹¨ ì¤‘ì…ë‹ˆë‹¤...</p>
            </div>

            <div id="result" class="bg-white p-4 rounded-lg shadow border border-blue-200 hidden">
                <h3 class="font-bold mb-2 text-blue-800">ğŸ’¡ ìƒì„¸ ì§„ë‹¨ê²°ê³¼ ë° í•´ê²°ë°©ë²•</h3>
                <div id="resultContent" class="text-sm text-gray-700 leading-relaxed whitespace-pre-wrap">ì§„ë‹¨ ì‹œì‘ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>
            </div>

            <div class="grid grid-cols-3 gap-2 mt-6 print:hidden">
                <a href="tel:1599-7380" class="flex items-center justify-center bg-green-600 text-white py-3 rounded-lg font-bold text-xs">
                    <i class="fas fa-phone-alt mr-1"></i> ë¬¸ì˜(1599-7380)
                </a>
                <button id="kakao-link-btn" class="flex items-center justify-center bg-yellow-400 text-black py-3 rounded-lg font-bold text-xs">
                    <i class="fas fa-comment mr-1"></i> ì¹´í†¡ì „ì†¡
                </button>
                <button onclick="savePDF()" class="flex items-center justify-center bg-gray-600 text-white py-3 rounded-lg font-bold text-xs">
                    <i class="fas fa-save mr-1"></i> ì €ì¥
                </button>
            </div>

        </main>

        <footer class="bg-gray-800 text-gray-400 py-6 px-4 text-center text-xs">
            <h3 class="text-white font-bold mb-2">### ì²­ê°œêµ¬ë¦¬ìƒ¤ì‹œ</h3>
            <p>ìƒí˜¸ : ì²­ê°œêµ¬ë¦¬ìƒ¤ì‹œ | ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ : 123-36-31426 | ëŒ€í‘œ : ì „ì˜ì›…</p>
            <p class="mt-1">ê³ ê°ì„¼í„° 1599-7380 (08:00~17:00 ì¼ìš”ì¼ì œì™¸) | COPYRIGHT â“’ 2025 All Rights Reserved.</p>
        </footer>

    </div>

    <script>
        // ì´ˆê¸°í™”
        document.getElementById('date').valueAsDate = new Date();
        const savedKey = localStorage.getItem('openai_api_key');
        if (savedKey) {
            document.getElementById('apiKey').value = savedKey;
            document.getElementById('apiKeySection').style.display = 'none';
        }

        // ì¹´ì¹´ì˜¤ ì´ˆê¸°í™” (í‚¤ê°€ ì—†ìœ¼ë©´ ì˜¤ë¥˜ê°€ ë‚  ìˆ˜ ìˆìŒ, ì´ì „ ì½”ë“œ ìœ ì§€)
        try {
            Kakao.init('YOUR_KAKAO_API_KEY'); 
        } catch (e) {
            console.log('ì¹´ì¹´ì˜¤ í‚¤ ë¯¸ì„¤ì •');
        }

        // API í‚¤ ì €ì¥
        function saveApiKey() {
            const key = document.getElementById('apiKey').value;
            if (key.startsWith('sk-')) {
                localStorage.setItem('openai_api_key', key);
                alert('API í‚¤ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
                document.getElementById('apiKeySection').style.display = 'none';
            } else {
                alert('ìœ íš¨í•œ API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            }
        }

        // í•˜ì ìœ í˜• ì„ íƒ
        function selectType(btn, type) {
            document.querySelectorAll('.type-btn').forEach(b => {
                b.classList.remove('bg-blue-600', 'text-white');
                b.classList.add('hover:bg-gray-100');
            });
            btn.classList.add('bg-blue-600', 'text-white');
            btn.classList.remove('hover:bg-gray-100');
            document.getElementById('defectType').value = type;
        }

        // ì´ë¯¸ì§€ ì—…ë¡œë“œ
        function triggerUpload(num) {
            document.getElementById(`fileInput${num}`).click();
        }

        function previewImage(event, num) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById(`preview${num}`).src = e.target.result;
                }
                reader.readAsDataURL(file);
            }
        }

        // AI ì§„ë‹¨
        async function analyzeImages() {
            const apiKey = localStorage.getItem('openai_api_key');
            if (!apiKey) {
                alert('API í‚¤ë¥¼ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            const img1 = document.getElementById('fileInput1').files[0];
            if (!img1) {
                alert('ìµœì†Œí•œ í˜„ì¥ ì‚¬ì§„(1ë²ˆ)ì€ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.');
                return;
            }

            document.getElementById('analyzeBtn').disabled = true;
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('result').classList.add('hidden');

            try {
                const images = [];
                if (img1) images.push(await toBase64(img1));
                const img2 = document.getElementById('fileInput2').files[0];
                if (img2) images.push(await toBase64(img2));
                const img3 = document.getElementById('fileInput3').files[0];
                if (img3) images.push(await toBase64(img3));

                const location = document.getElementById('location').value;
                const date = document.getElementById('date').value;
                const type = document.getElementById('defectType').value || "ì¼ë°˜";
                const desc = document.getElementById('description').value;

                const messages = [
                    {
                        role: "system",
                        content: "ë‹¹ì‹ ì€ 30ë…„ ê²½ë ¥ì˜ ë² í…Œë‘ ê±´ì¶• ì‹œê³µ ë° í•˜ì ë³´ìˆ˜ ì „ë¬¸ê°€ 'ì²­ê°œêµ¬ë¦¬ ë°•ì‚¬'ì…ë‹ˆë‹¤. ì‚¬ì§„ì„ ë¶„ì„í•˜ì—¬ ì›ì¸, í•´ê²°ì±…, ê²¬ì  ë²”ìœ„ë¥¼ ì¹œì ˆí•˜ê³  ìƒì„¸í•˜ê²Œ ì„¤ëª…í•´ì£¼ì„¸ìš”."
                    },
                    {
                        role: "user",
                        content: [
                            { type: "text", text: `ì¥ì†Œ: ${location}, ì¼ì: ${date}, ìœ í˜•: ${type}, ë‚´ìš©: ${desc}. ì´ í•˜ìì˜ ì›ì¸ê³¼ í•´ê²°ì±…ì„ ì§„ë‹¨í•´ì¤˜.` },
                            ...images.map(img => ({ type: "image_url", image_url: { url: img } }))
                        ]
                    }
                ];

                const response = await fetch("https://api.openai.com/v1/chat/completions", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: "gpt-4o",
                        messages: messages,
                        max_tokens: 1500
                    })
                });

                const data = await response.json();
                if (data.error) throw new Error(data.error.message);

                document.getElementById('resultContent').innerHTML = data.choices[0].message.content.replace(/\n/g, '<br>');
                document.getElementById('result').classList.remove('hidden');

            } catch (error) {
                alert('ì˜¤ë¥˜ ë°œìƒ: ' + error.message);
            } finally {
                document.getElementById('analyzeBtn').disabled = false;
                document.getElementById('loading').classList.add('hidden');
            }
        }

        function toBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });
        }

        async function savePDF() {
            const buttons = document.querySelector('.print\\:hidden');
            buttons.style.display = 'none';
            window.scrollTo(0,0);
            
            const canvas = await html2canvas(document.getElementById('capture-area'), { scale: 2 });
            const imgData = canvas.toDataURL('image/jpeg', 1.0);
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF('p', 'mm', 'a4');
            const imgHeight = canvas.height * 210 / canvas.width;
            
            pdf.addImage(imgData, 'JPEG', 0, 0, 210, imgHeight);
            pdf.save(`í•˜ìì§„ë‹¨_${document.getElementById('location').value}.pdf`);
            
            buttons.style.display = 'grid';
        }
    </script>
</body>
</html>
