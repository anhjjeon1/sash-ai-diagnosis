<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì²­ê°œêµ¬ë¦¬ í•˜ìì§„ë‹¨ AIë¶„ì„ì•±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');
        body { font-family: 'Noto Sans KR', sans-serif; }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-indigo-50 min-h-screen">
    <div id="capture-area" class="max-w-md mx-auto bg-white min-h-screen shadow-2xl overflow-hidden relative">
        
        <header class="bg-indigo-600 p-4 text-white text-center shadow-lg relative">
            <h1 class="text-xl font-bold flex items-center justify-center gap-2">
                <i class="fas fa-frog text-2xl"></i> ì²­ê°œêµ¬ë¦¬ í•˜ìì§„ë‹¨ AIë¶„ì„ì•±
            </h1>
            <p class="text-xs mt-1 text-indigo-200">Ver 10.9 (ìµœì¢…ì™„ì„±)</p>
        </header>

        <main class="p-5 pb-24">
            
            <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6 rounded-r-lg shadow-sm" id="apiKeySection">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-sm font-bold text-yellow-800"><i class="fas fa-key mr-2"></i>API í‚¤ ì…ë ¥ (ìµœì´ˆ 1íšŒ)</span>
                </div>
                <div class="flex gap-2">
                    <input type="password" id="apiKey" placeholder="sk-..." class="flex-1 p-2 border border-yellow-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-yellow-500">
                    <button onclick="saveApiKey()" class="bg-yellow-500 text-white px-3 py-1 rounded text-sm font-bold hover:bg-yellow-600 transition">ì €ì¥</button>
                </div>
            </div>

            <div class="space-y-4 mb-6">
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-1"><i class="fas fa-home mr-2 text-indigo-500"></i>ì¥ì†Œì…ë ¥</label>
                    <input type="text" id="location" class="w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:outline-none transition" placeholder="ì˜ˆ: ì„œìš¸ì‹œ ê°•ë‚¨êµ¬ ì—­ì‚¼ë™ ì•„íŒŒíŠ¸">
                </div>
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-1"><i class="fas fa-calendar-alt mr-2 text-indigo-500"></i>ì§„ë‹¨ì¼ì</label>
                    <input type="date" id="date" class="w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:outline-none transition">
                </div>
                
                <div class="grid grid-cols-3 gap-2">
                    <button onclick="selectType(this, 'ê±´ì¶•')" class="type-btn p-2 border rounded-lg text-sm font-medium hover:bg-indigo-50 transition">ê±´ì¶•í•˜ì</button>
                    <button onclick="selectType(this, 'ì°½í˜¸')" class="type-btn p-2 border rounded-lg text-sm font-medium hover:bg-indigo-50 transition">ì°½í˜¸í•˜ì</button>
                    <button onclick="selectType(this, 'ê²°ë¡œ')" class="type-btn p-2 border rounded-lg text-sm font-medium hover:bg-indigo-50 transition">ê²°ë¡œí•˜ì</button>
                    <button onclick="selectType(this, 'ëˆ„ìˆ˜')" class="type-btn p-2 border rounded-lg text-sm font-medium hover:bg-indigo-50 transition">ëˆ„ìˆ˜í•˜ì</button>
                    <button onclick="selectType(this, 'ì†ŒìŒ')" class="type-btn p-2 border rounded-lg text-sm font-medium hover:bg-indigo-50 transition">ì†ŒìŒí•˜ì</button>
                    <button onclick="selectType(this, 'ê¸°íƒ€')" class="type-btn p-2 border rounded-lg text-sm font-medium hover:bg-indigo-50 transition">ê¸°íƒ€</button>
                </div>
                <input type="hidden" id="defectType">

                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-1"><i class="fas fa-edit mr-2 text-indigo-500"></i>í•˜ìì„¤ëª…</label>
                    <textarea id="description" rows="3" class="w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:outline-none transition" placeholder="í•˜ì ìƒí™©ì„ ê°„ë‹¨íˆ ì ì–´ì£¼ì„¸ìš”"></textarea>
                </div>
            </div>

            <div class="bg-white p-6 rounded-2xl shadow-md mb-6 relative overflow-hidden group hover:shadow-lg transition border border-gray-100">
                <div class="absolute top-0 left-0 w-2 h-full bg-indigo-500"></div>
                <h3 class="text-lg font-bold mb-4 flex items-center text-indigo-700">
                    ğŸ“¸ 1. í˜„ì¥ ì‚¬ì§„(í•„ìˆ˜)
                </h3>
                <img id="preview1" src="placeholder.png" alt="í˜„ì¥ ì‚¬ì§„" class="w-full h-64 object-cover rounded-lg border-2 border-dashed border-gray-300 mb-4 cursor-pointer hover:opacity-80 transition" onclick="triggerUpload(1)">
                <input type="file" id="fileInput1" accept="image/*" class="hidden" onchange="previewImage(event, 1)">
                <button onclick="triggerUpload(1)" class="w-full bg-indigo-100 text-indigo-700 py-3 rounded-xl font-bold hover:bg-indigo-200 transition flex items-center justify-center">
                    <i class="fas fa-camera mr-2"></i> ì‚¬ì§„ì…ë ¥
                </button>
                <p class="text-xs text-center text-gray-400 mt-2">ì‚¬ì§„ì…ë ¥ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì‚¬ì§„ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”!</p>
            </div>

            <div class="bg-white p-6 rounded-2xl shadow-md mb-6 relative overflow-hidden group hover:shadow-lg transition border border-gray-100">
                <div class="absolute top-0 left-0 w-2 h-full bg-blue-500"></div>
                <h3 class="text-lg font-bold mb-4 flex items-center text-blue-700">
                    ğŸ“¸ 2. ìƒì„¸/ê¸°íƒ€ ì‚¬ì§„(ì„ íƒ)
                </h3>
                <img id="preview2" src="placeholder.png" alt="ìƒì„¸ ì‚¬ì§„" class="w-full h-64 object-cover rounded-lg border-2 border-dashed border-gray-300 mb-4 cursor-pointer hover:opacity-80 transition" onclick="triggerUpload(2)">
                <input type="file" id="fileInput2" accept="image/*" class="hidden" onchange="previewImage(event, 2)">
                <button onclick="triggerUpload(2)" class="w-full bg-blue-100 text-blue-700 py-3 rounded-xl font-bold hover:bg-blue-200 transition flex items-center justify-center">
                    <i class="fas fa-camera mr-2"></i> ì‚¬ì§„ì…ë ¥
                </button>
                <p class="text-xs text-center text-gray-400 mt-2">ì‚¬ì§„ì…ë ¥ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì‚¬ì§„ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”!</p>
            </div>

            <div class="bg-white p-6 rounded-2xl shadow-md mb-6 relative overflow-hidden group hover:shadow-lg transition border border-gray-100">
                <div class="absolute top-0 left-0 w-2 h-full bg-orange-500"></div>
                <h3 class="text-lg font-bold mb-4 flex items-center text-orange-700">
                    ğŸ“¸ 3. ì—´í™”ìƒ/ê¸°íƒ€ ì‚¬ì§„(ì„ íƒ)
                </h3>
                <img id="preview3" src="placeholder.png" alt="ì—´í™”ìƒ ì‚¬ì§„" class="w-full h-64 object-cover rounded-lg border-2 border-dashed border-gray-300 mb-4 cursor-pointer hover:opacity-80 transition" onclick="triggerUpload(3)">
                <input type="file" id="fileInput3" accept="image/*" class="hidden" onchange="previewImage(event, 3)">
                <button onclick="triggerUpload(3)" class="w-full bg-orange-100 text-orange-700 py-3 rounded-xl font-bold hover:bg-orange-200 transition flex items-center justify-center">
                    <i class="fas fa-camera mr-2"></i> ì‚¬ì§„ì…ë ¥
                </button>
                <p class="text-xs text-center text-gray-400 mt-2">ì‚¬ì§„ì…ë ¥ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì‚¬ì§„ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”!</p>
            </div>

            <button onclick="analyzeImages()" id="analyzeBtn" class="w-full bg-gradient-to-r from-indigo-600 to-blue-600 text-white py-4 rounded-xl font-bold text-lg shadow-lg hover:from-indigo-700 hover:to-blue-700 transition transform hover:scale-[1.02] active:scale-95 mb-6">
                <i class="fas fa-robot mr-2"></i> AI ì •ë°€ ì§„ë‹¨ ì‹œì‘
            </button>

            <div id="loading" class="hidden flex-col items-center justify-center py-10 space-y-4">
                <div class="loader"></div>
                <p class="text-gray-600 animate-pulse font-medium">â³ AI ì „ë¬¸ê°€ê°€ ì •ë°€ ì§„ë‹¨ ì¤‘ì…ë‹ˆë‹¤...</p>
            </div>

            <div id="result" class="bg-white p-6 rounded-2xl shadow-lg border-t-4 border-indigo-500 hidden">
                <h3 class="text-xl font-bold mb-4 flex items-center text-gray-800 border-b pb-2">
                    <i class="fas fa-lightbulb text-yellow-500 mr-2"></i> ìƒì„¸ ì§„ë‹¨ê²°ê³¼ ë° í•´ê²°ë°©ë²•
                </h3>
                <div id="resultContent" class="prose max-w-none text-gray-700 leading-relaxed text-sm"></div>
            </div>

            <div class="grid grid-cols-2 gap-4 mt-6 print:hidden">
                <a href="tel:1599-7380" class="flex items-center justify-center bg-blue-600 text-white px-6 py-3 rounded-xl hover:bg-blue-700 transition shadow-lg font-bold">
                    <i class="fas fa-phone-alt mr-2"></i> ë¬¸ì˜(1599-7380)
                </a>
                <button onclick="savePDF()" class="flex items-center justify-center bg-gray-600 text-white px-6 py-3 rounded-xl hover:bg-gray-700 transition shadow-lg font-bold">
                    <i class="fas fa-save mr-2"></i> ì €ì¥
                </button>
            </div>
            
        </main>

        <footer class="bg-gray-800 text-gray-400 py-8 px-4 text-center text-xs mt-8">
            <h3 class="text-white text-lg font-bold mb-2">ì²­ê°œêµ¬ë¦¬ìƒ¤ì‹œ</h3>
            <div class="space-y-1">
                <p>ìƒí˜¸ : ì²­ê°œêµ¬ë¦¬ìƒ¤ì‹œ | ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ : 123-36-31426 | ëŒ€í‘œ : ì „ì˜ì›…</p>
                <p class="mt-2">ê³ ê°ì„¼í„° 1599-7380 (08:00~17:00 ì¼ìš”ì¼ì œì™¸)</p>
                <p class="mt-4 text-gray-500">COPYRIGHT â“’ 2025 All Rights Reserved.</p>
            </div>
        </footer>

    </div>

    <script>
        // ì´ˆê¸°í™”
        document.getElementById('date').valueAsDate = new Date();
        const savedKey = localStorage.getItem('openai_api_key');
        if (savedKey) {
            document.getElementById('apiKey').value = savedKey;
            document.getElementById('apiKeySection').style.display = 'none';
        }

        // API í‚¤ ì €ì¥
        function saveApiKey() {
            const key = document.getElementById('apiKey').value;
            if (key.startsWith('sk-')) {
                localStorage.setItem('openai_api_key', key);
                alert('API í‚¤ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
                document.getElementById('apiKeySection').style.display = 'none';
            } else {
                alert('ìœ íš¨í•œ API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            }
        }

        // í•˜ì ìœ í˜• ì„ íƒ
        function selectType(btn, type) {
            document.querySelectorAll('.type-btn').forEach(b => {
                b.classList.remove('bg-indigo-600', 'text-white', 'border-transparent');
                b.classList.add('border-gray-200');
            });
            btn.classList.add('bg-indigo-600', 'text-white', 'border-transparent');
            btn.classList.remove('border-gray-200');
            document.getElementById('defectType').value = type;
        }

        // ì´ë¯¸ì§€ ì—…ë¡œë“œ íŠ¸ë¦¬ê±°
        function triggerUpload(num) {
            document.getElementById(`fileInput${num}`).click();
        }

        // ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°
        function previewImage(event, num) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = document.getElementById(`preview${num}`);
                    img.src = e.target.result;
                    img.classList.remove('border-dashed');
                    img.classList.add('border-solid', 'border-indigo-500');
                }
                reader.readAsDataURL(file);
            }
        }

        // AI ì§„ë‹¨ ì‹¤í–‰
        async function analyzeImages() {
            const apiKey = localStorage.getItem('openai_api_key');
            if (!apiKey) {
                alert('API í‚¤ë¥¼ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”.');
                document.getElementById('apiKeySection').style.display = 'block';
                return;
            }

            const img1 = document.getElementById('fileInput1').files[0];
            if (!img1) {
                alert('ìµœì†Œí•œ í˜„ì¥ ì‚¬ì§„(1ë²ˆ)ì€ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.');
                return;
            }

            // ë¡œë”© í‘œì‹œ
            document.getElementById('analyzeBtn').disabled = true;
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('result').classList.add('hidden');

            try {
                const images = [];
                // ì´ë¯¸ì§€ Base64 ë³€í™˜
                if (img1) images.push(await toBase64(img1));
                
                const img2 = document.getElementById('fileInput2').files[0];
                if (img2) images.push(await toBase64(img2));
                
                const img3 = document.getElementById('fileInput3').files[0];
                if (img3) images.push(await toBase64(img3));

                // í”„ë¡¬í”„íŠ¸ êµ¬ì„±
                const location = document.getElementById('location').value;
                const date = document.getElementById('date').value;
                const type = document.getElementById('defectType').value || "ì¼ë°˜";
                const desc = document.getElementById('description').value;

                const messages = [
                    {
                        role: "system",
                        content: "ë‹¹ì‹ ì€ 30ë…„ ê²½ë ¥ì˜ ë² í…Œë‘ ê±´ì¶• ì‹œê³µ ë° í•˜ì ë³´ìˆ˜ ì „ë¬¸ê°€ 'ì²­ê°œêµ¬ë¦¬ ë°•ì‚¬'ì…ë‹ˆë‹¤. ì‚¬ì§„ì„ ë¶„ì„í•˜ì—¬ ì›ì¸, í•´ê²°ì±…, ê²¬ì  ë²”ìœ„ë¥¼ ì¹œì ˆí•˜ê³  ìƒì„¸í•˜ê²Œ ì„¤ëª…í•´ì£¼ì„¸ìš”. ì „ë¬¸ ìš©ì–´ë¥¼ ì“°ë˜ ì¼ë°˜ì¸ë„ ì•Œê¸° ì‰½ê²Œ ì„¤ëª…í•˜ì„¸ìš”. ë‹µë³€ì€ ë§ˆí¬ë‹¤ìš´ í˜•ì‹ìœ¼ë¡œ ì‘ì„±í•´ ì£¼ì„¸ìš”."
                    },
                    {
                        role: "user",
                        content: [
                            { type: "text", text: `ì§„ë‹¨ ìš”ì²­ ì •ë³´:\n- ì¥ì†Œ: ${location}\n- ì¼ì: ${date}\n- í•˜ì ìœ í˜•: ${type}\n- ì„¤ëª…: ${desc}\n\nì´ ì‚¬ì§„ë“¤ì„ ë³´ê³  í•˜ìì˜ êµ¬ì²´ì ì¸ ì›ì¸ê³¼ ë‹¨ê³„ë³„ í•´ê²° ë°©ë²•, ê·¸ë¦¬ê³  í•„ìš”í•œ ìì¬ë‚˜ ì˜ˆìƒë˜ëŠ” ì¡°ì¹˜ ì‚¬í•­ì„ ìƒì„¸íˆ ì•Œë ¤ì£¼ì„¸ìš”.` },
                            ...images.map(img => ({ type: "image_url", image_url: { url: img } }))
                        ]
                    }
                ];

                const response = await fetch("https://api.openai.com/v1/chat/completions", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: "gpt-4o",
                        messages: messages,
                        max_tokens: 2000
                    })
                });

                const data = await response.json();

                if (data.error) throw new Error(data.error.message);

                const answer = data.choices[0].message.content;
                
                // ê²°ê³¼ í‘œì‹œ (ë§ˆí¬ë‹¤ìš´ ì¤„ë°”ê¿ˆ ì²˜ë¦¬)
                document.getElementById('resultContent').innerHTML = answer.replace(/\n/g, '<br>').replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                document.getElementById('result').classList.remove('hidden');
                
                // ìŠ¤í¬ë¡¤ ì´ë™
                document.getElementById('result').scrollIntoView({ behavior: 'smooth' });

            } catch (error) {
                alert('ì§„ë‹¨ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            } finally {
                document.getElementById('analyzeBtn').disabled = false;
                document.getElementById('loading').classList.add('hidden');
            }
        }

        // ì´ë¯¸ì§€ Base64 ë³€í™˜ í•¨ìˆ˜
        function toBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });
        }

        // PDF ì €ì¥ (ìˆ˜ì •ë¨: ì¹´í†¡ ê´€ë ¨ ì½”ë“œ ì œê±°)
        async function savePDF() {
            // ë²„íŠ¼ ìˆ¨ê¸°ê¸°
            const buttons = document.querySelector('.print\\:hidden');
            if(buttons) buttons.style.display = 'none';

            window.scrollTo(0, 0);
            
            try {
                const canvas = await html2canvas(document.getElementById('capture-area'), {
                    scale: 2,
                    useCORS: true,
                    logging: false
                });
                
                const imgData = canvas.toDataURL('image/jpeg', 1.0);
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF('p', 'mm', 'a4');
                const imgWidth = 210;
                const pageHeight = 297;
                const imgHeight = canvas.height * imgWidth / canvas.width;
                
                let heightLeft = imgHeight;
                let position = 0;

                pdf.addImage(imgData, 'JPEG', 0, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;

                while (heightLeft >= 0) {
                    position = heightLeft - imgHeight;
                    pdf.addPage();
                    pdf.addImage(imgData, 'JPEG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                }

                const fileName = `í•˜ìì§„ë‹¨_${document.getElementById('location').value}_${new Date().toISOString().slice(0,10)}.pdf`;
                pdf.save(fileName);

            } catch (e) {
                alert('PDF ì €ì¥ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ' + e.message);
            } finally {
                if(buttons) buttons.style.display = 'grid'; // ë²„íŠ¼ ë³µêµ¬
            }
        }
    </script>
</body>
</html>
