<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì²­ê°œêµ¬ë¦¬ ê²°ë¡œ ì§„ë‹¨ AI</title>
    <style>
        /* [ìŠ¤íƒ€ì¼ ì„¤ì •] - ì²­ê°œêµ¬ë¦¬ í…Œë§ˆ */
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f0fdf4; /* ì—°í•œ ë…¹ìƒ‰ ë°°ê²½ */
            margin: 0;
            padding: 20px;
            color: #333;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        h2 {
            text-align: center;
            color: #166534; /* ì§„í•œ ë…¹ìƒ‰ */
            margin-bottom: 20px;
        }
        .input-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #15803d;
        }
        input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-sizing: border-box; /* íŒ¨ë”© í¬í•¨ í¬ê¸° ê³„ì‚° */
            font-size: 16px;
        }
        button {
            width: 100%;
            padding: 15px;
            background-color: #22c55e; /* ë°ì€ ë…¹ìƒ‰ */
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
        }
        button:hover {
            background-color: #16a34a;
        }
        
        /* ê²°ê³¼ ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
        #resultArea {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            background-color: #ecfccb;
            display: none; /* ì²˜ìŒì—” ìˆ¨ê¹€ */
            border: 1px solid #bef264;
        }
        
        /* ê¸°ë¡ ë³´ê¸° ë²„íŠ¼ */
        .history-btn {
            background-color: #374151; /* ì§„íšŒìƒ‰ */
            margin-top: 10px;
        }

        /* íŒì—…(ëª¨ë‹¬) ìŠ¤íƒ€ì¼ */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
        }
        .modal-content {
            background-color: white;
            margin: 15% auto;
            padding: 20px;
            width: 85%;
            max-width: 500px;
            border-radius: 10px;
            max-height: 70vh;
            overflow-y: auto;
            position: relative;
        }
        .close-btn {
            float: right;
            font-size: 24px;
            cursor: pointer;
            font-weight: bold;
        }
        
        /* ê¸°ë¡ ë¦¬ìŠ¤íŠ¸ ì•„ì´í…œ ìŠ¤íƒ€ì¼ - ì—¬ê¸°ê°€ ì¤‘ìš”í•©ë‹ˆë‹¤ */
        .history-item {
            border-bottom: 1px solid #eee;
            padding: 10px 0;
        }
        .history-date {
            font-size: 12px;
            color: #888;
        }
        .history-result {
            font-size: 16px;
            font-weight: bold;
            color: #166534;
            margin-top: 4px;
        }
        .history-detail {
            font-size: 13px;
            color: #555;
        }
        .delete-btn {
            background-color: #ef4444; /* ë¹¨ê°• */
            margin-top: 20px;
        }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸ¸ ì²­ê°œêµ¬ë¦¬ ê²°ë¡œ ì§„ë‹¨ (Ver 2.2)</h2>
    
    <div class="input-group">
        <label>ğŸ  ì‹¤ë‚´ ì˜¨ë„ (Â°C)</label>
        <input type="number" id="inTemp" placeholder="ì˜ˆ: 22" inputmode="decimal">
    </div>

    <div class="input-group">
        <label>ğŸ’§ ì‹¤ë‚´ ìŠµë„ (%)</label>
        <input type="number" id="humidity" placeholder="ì˜ˆ: 55" inputmode="decimal">
    </div>

    <div class="input-group">
        <label>â„ï¸ ì‹¤ì™¸ ì˜¨ë„ (Â°C)</label>
        <input type="number" id="outTemp" placeholder="ì˜ˆ: -5" inputmode="decimal">
    </div>

    <button onclick="diagnose()">ì§„ë‹¨í•˜ê¸°</button>
    <div id="resultArea"></div>
    
    <button class="history-btn" onclick="openHistory()">ğŸ“‹ ì§„ë‹¨ ê¸°ë¡ ë³´ê¸°</button>
</div>

<div id="historyModal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeHistory()">&times;</span>
        <h3>ì§€ë‚œ ì§„ë‹¨ ê¸°ë¡</h3>
        <div id="historyList">
            </div>
        <button class="delete-btn" onclick="clearHistory()">ê¸°ë¡ ì „ì²´ ì‚­ì œ</button>
    </div>
</div>

<script>
    // [í•µì‹¬ ë¡œì§]
    
    function diagnose() {
        // 1. ì…ë ¥ê°’ ê°€ì ¸ì˜¤ê¸°
        const inTemp = parseFloat(document.getElementById('inTemp').value);
        const humidity = parseFloat(document.getElementById('humidity').value);
        const outTemp = parseFloat(document.getElementById('outTemp').value);

        // ê°’ ìœ íš¨ì„± ê²€ì‚¬
        if (isNaN(inTemp) || isNaN(humidity) || isNaN(outTemp)) {
            alert("ëª¨ë“  ê°’ì„ ìˆ«ìë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            return;
        }

        // 2. ê°„ë‹¨í•œ ê²°ë¡œ ì§„ë‹¨ ë¡œì§ (ì˜ˆì‹œ ì•Œê³ ë¦¬ì¦˜)
        // (ì‹¤ì œ ì´ìŠ¬ì  ê³µì‹ë³´ë‹¤ ê°„ë‹¨í•˜ê²Œ: ì˜¨ë„ì°¨ê°€ í¬ê³  ìŠµë„ê°€ ë†’ìœ¼ë©´ ìœ„í—˜)
        let resultMessage = "";
        let color = "";
        
        // ì´ìŠ¬ì (Dew Point) ê·¼ì‚¬ì¹˜ ê³„ì‚° ê³µì‹
        const dewPoint = inTemp - ((100 - humidity) / 5);
        // ì°½ë¬¸ í‘œë©´ì˜¨ë„ ì¶”ì • (ì‹¤ë‚´ì™€ ì‹¤ì™¸ì˜ ì¤‘ê°„ê°’ ë³´ë‹¤ëŠ” ì‹¤ì™¸ì— ë” ì˜í–¥ì„ ë°›ìŒ ê°€ì •)
        // ì¼ë°˜ ìœ ë¦¬ì°½ ê¸°ì¤€ (ëŒ€ëµì )
        const windowSurfaceTemp = (inTemp * 0.3) + (outTemp * 0.7);

        if (windowSurfaceTemp < dewPoint) {
            resultMessage = "âš ï¸ ê²°ë¡œ ë°œìƒ 'ìœ„í—˜' ë‹¨ê³„ì…ë‹ˆë‹¤!";
            color = "#ef4444"; // ë¹¨ê°•
        } else if (windowSurfaceTemp < dewPoint + 3) {
            resultMessage = "âš ï¸ ê²°ë¡œ ë°œìƒ 'ì£¼ì˜' ë‹¨ê³„ì…ë‹ˆë‹¤.";
            color = "#f59e0b"; // ì£¼í™©
        } else {
            resultMessage = "âœ… í˜„ì¬ ìƒíƒœëŠ” 'ì•ˆì „'í•©ë‹ˆë‹¤.";
            color = "#166534"; // ì´ˆë¡
        }

        // 3. ê²°ê³¼ í™”ë©´ì— ë³´ì—¬ì£¼ê¸°
        const resultArea = document.getElementById('resultArea');
        resultArea.style.display = 'block';
        resultArea.innerHTML = `<strong style="color:${color}">${resultMessage}</strong><br>
                                <small>ì˜ˆìƒ ì´ìŠ¬ì : ì•½ ${dewPoint.toFixed(1)}Â°C</small>`;

        // 4. [ì¤‘ìš”] ë°ì´í„° ì €ì¥í•˜ê¸°
        saveData(inTemp, humidity, outTemp, resultMessage);
    }

    // ë°ì´í„° ì €ì¥ í•¨ìˆ˜
    function saveData(inT, hum, outT, msg) {
        const historyData = JSON.parse(localStorage.getItem('condensation_history')) || [];
        
        const newRecord = {
            date: new Date().toLocaleString(), // ë‚ ì§œ
            inTemp: inT,                       // ì‹¤ë‚´ì˜¨ë„
            humidity: hum,                     // ìŠµë„
            outTemp: outT,                     // ì‹¤ì™¸ì˜¨ë„
            result: msg                        // [ì¤‘ìš”] ì§„ë‹¨ ê²°ê³¼ ë©”ì‹œì§€
        };

        historyData.unshift(newRecord); // ìµœì‹  ê¸€ì„ ë§¨ ìœ„ë¡œ
        localStorage.setItem('condensation_history', JSON.stringify(historyData));
    }

    // ê¸°ë¡ íŒì—… ì—´ê¸°
    function openHistory() {
        const modal = document.getElementById('historyModal');
        const listArea = document.getElementById('historyList');
        const historyData = JSON.parse(localStorage.getItem('condensation_history')) || [];

        modal.style.display = 'block';
        listArea.innerHTML = ""; // ê¸°ì¡´ ë‚´ìš© ì´ˆê¸°í™”

        if (historyData.length === 0) {
            listArea.innerHTML = "<p>ì €ì¥ëœ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>";
            return;
        }

        // [ë¬¸ì œ í•´ê²° í¬ì¸íŠ¸] ì—¬ê¸°ì„œ ë°ì´í„°ë¥¼ í™”ë©´ì— ê·¸ë¦½ë‹ˆë‹¤.
        historyData.forEach((item) => {
            listArea.innerHTML += `
                <div class="history-item">
                    <div class="history-date">${item.date}</div>
                    <div class="history-result">${item.result}</div>
                    <div class="history-detail">
                        ì‹¤ë‚´ ${item.inTemp}Â°C / ìŠµë„ ${item.humidity}% / ì‹¤ì™¸ ${item.outTemp}Â°C
                    </div>
                </div>
            `;
        });
    }

    function closeHistory() {
        document.getElementById('historyModal').style.display = 'none';
    }

    function clearHistory() {
        if(confirm("ì •ë§ë¡œ ëª¨ë“  ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            localStorage.removeItem('condensation_history');
            openHistory(); // í™”ë©´ ê°±ì‹ 
        }
    }

    // íŒì—… ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
    window.onclick = function(event) {
        const modal = document.getElementById('historyModal');
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }
</script>

</body>
</html>
